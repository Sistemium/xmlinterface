<?xml version="1.0" ?>
<domain version="1.0"
    xmlns:xi="http://unact.net/xml/xi"
    xmlns="http://unact.net/xml/xi"
>
    
    <concept name="upp">
        <select owner="sys" sql-name="dummy"/>
    </concept>
    
    <concept name="upp-deal">
        
        <select owner="upp" sql-name="deal" type="procedure"/>
        <save owner="upp" sql-name="deal"/>
        
        <property name="id" key="true" type="int"/>
        
        <property name="date" type="date" sql-name="ddate" label="Дата"/>
        <property name="summ" type="decimal" label="Обязательства клиента"/>
        <property name="usumm" type="decimal" label="Наши обязательства"/>
        
        <property name="rem-summ" type="decimal" label="Остаток обязательств клиента" sql-name="rem_summ"/>
        <property name="rem-usumm" type="decimal" label="Остаток наших обязательств" sql-name="rem_usumm"/>
        
        <property name="rem" type="decimal" />
        
        <property name="is-final" type="boolean" sql-name="status" label="Завершена?"/>
        
        <property name="p-date" type="date" label="Дата клиента" sql-name="partnerddate"/>
        
        <property name="ts" type="datetime" sql-name="ts" label="Дата обновления"/>
        
        <property name="pay-request-comment" sql-name="pay_request_comment" sql-compute="NULL"/>
        <property name="upp-casher" sql-name="pay_request_cashclient" sql-compute="NULL"/>
        
        <role name="upp-client" actor="upp-client" sql-name="partner"/>
        <role name="upp-type" actor="upp-type" sql-name="type"/>
        
    </concept>
    
    
    <concept name="upp-client">
        
        <select owner="upp" sql-name="client" type="procedure"/>
        
        <property name="id" key="true" type="int"/>
        <property name="name" label="Название"/>
        
    </concept>
    
    
    <concept name="upp-casher">
        
        <select owner="dbo" sql-name="cashclients" />
        
        <property name="id" key="true" type="int"/>
        <property name="name" label="Название"/>
        
        <role name="upp-client" actor="upp-client" sql-name="partner"/>
        
    </concept>
    
    
    <concept name="upp-type">
        
        <select owner="upp" sql-name="type" type="procedure"/>
        
        <property name="id" key="true" type="int"/>
        <property name="name" label="Название"/>
        
    </concept>
    
    
    <concept name="upp-client-balance">
        
        <select owner="upp" sql-name="balance" type="procedure">
            <parameter name="upp-client" type="int" sql-name="@client"/>
        </select>
        
        <property name="date" type="date" sql-name="ddate" label="Дата"/>
        <property name="isumm" type="decimal" sql-name="isumm" label="Приход"/>
        <property name="rsumm" type="decimal" sql-name="rsumm" label="Расход"/>
        <property name="i1" type="string" sql-name="i1" label="Вид начислений"/>
        <property name="i2" type="string" sql-name="i2" label="Комментарий"/>
        
        <property name="balance" type="decimal" sql-name="balance" label="Баланс"/>
        
        <property name="balance-start" type="decimal" sql-name="bsumm" label="Баланс на начало периода"/>
        <property name="balance-end" type="decimal" sql-name="esumm" label="Баланс на конец периода"/>
        
        <role name="upp-client" actor="upp-client" />
        
    </concept>
    
    
    <concept name="upp-rate">
        
        <select owner="upp" sql-name="rate" type="procedure">
            <parameter name="date" type="date" sql-name="@date" />
            <parameter name="upp-client" type="int" sql-name="@client" required="true"/>
        </select>
        
        <!--select owner="dbo" sql-name="dealrate"/-->
        
        <property name="id" type="int" key="true"/>
        <property name="xid"/>
        
        <property name="ddateb" type="date" sql-name="ddateb"/>
        <property name="ddatee" type="date" sql-name="ddatee"/>
        <property name="rate" type="decimal" sql-name="rate"/>
        <property name="ts" type="datetime" sql-name="ts"/>
        
        <role name="upp-client" actor="upp-client"/>
        
    </concept>
    
    <concept name="upp-pay-request">
        
        <select owner="dbo" sql-name="pay_request"/>
        <save owner="dbo" sql-name="pay_request"/>
        
        <property name="id" type="int" key="true"/>
        <property name="xid" sql-name="xid"/>
        
        <property name="date" type="datetime" sql-name="ddate" label="Дата"/>
        <property name="summ" type="decimal" label="Сумма"/>
        <property name="is-committed" type="boolean" sql-name="isaccepted" label="Утверждено?"/>
        <property name="acceptor" label="Утвердил"/>        
        <property name="info" label="Комментарий"/>
        
        <role name="upp-client" actor="upp-client" sql-name="partner"/>
        <role name="upp-casher" actor="upp-casher" sql-name="cclient"/>
        
    </concept>
    
</domain>