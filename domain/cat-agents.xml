<?xml version="1.0" ?>
<domain version="1.0"
    xmlns:xi="http://unact.net/xml/xi"
    xmlns="http://unact.net/xml/xi"
>

   <concept name="agent">
        <select type="procedure" owner="dbo">
            <parameter- name="tabnum" type="int" sql-name="@tabnum"/>
        </select>
        <property name="id" key="true"/>
        <order-by column="name"/>
    </concept>


    <concept name="geoposition">
        
        <select owner="geo" sql-name="position" />
        <save owner="geo" sql-name="position" />
        
        <property name="xid" />
        
        <property name="id" key="true" type="int" />
        
        <property name="ts" type="datetime" />
        
        <property name="longitude" type="decimal" />
        <property name="latitude" type="decimal" />
        <property name="accuracy" type="decimal" />
        <property name="speed" type="decimal" />
        <property name="errorCode" type="int" />
        <property name="deviceCts" type="datetime" sql-name="device_ts" />
        
        <role actor="cat-salesman" name="cat-salesman" sql-name="entity" />
        
    </concept>
    

    <concept name="iorders-eventlog">
        
        <select owner="iorders" sql-name="eventlog" />
        <save owner="iorders" sql-name="eventlog" />
        
        <property name="xid" />
        
        <property name="id" key="true" type="int" />
        
        <property name="ts" type="datetime" />
        <property name="cts" type="datetime" />
        
        <property name="module" type="string" />
        <property name="action" type="string" />
        <property name="data" type="string" />
        
        <property name="deviceCts" type="datetime" sql-name="device_cts" />
        
        <role actor="cat-salesman" name="cat-salesman" sql-name="palm_salesman" />
        
    </concept>

    <concept name="salesman-route">
    
        <select owner="dbo" sql-name="salesman_route"/>
        
        <property name="id" type="int" key="true" />
        <property name="name" type="string" label="Название"/>
        <property name="ord" type="int" sql-name="id"/>
        
        <property name="xid"/>
        
        <role name="cat-salesman" actor="cat-salesman" sql-name="salesman"/>
        
    </concept>

    <concept name="salesman-route-point">
    
        <select owner="dbo" sql-name="palm_RoutePoint"/>
        
        <property name="ord" type="int" label="Очередность" sql-name="hhmm"/>
        
        <property name="xid"/>
        
        <role name="cat-salesman" actor="cat-salesman" sql-name="salesman_id"/>
        <role name="salesman-route" actor="salesman-route" sql-name="routetype_id"/>
        <role name="cat-buyer" actor="cat-buyer" sql-name="client_id"/>
        
    </concept>

    <concept name="cat-salesman">
        
        <select owner="dbo" sql-name="palm_salesman"/>
        
        <property name="id" type="int" key="true" sql-name="salesman_id"/>
        <property name="name" type="string" label="Имя"/>
        <property name="username" type="string" label="Логин" sql-name="loginname"/>
        <property name="xid"/>
        <role name="cat-agent" actor="cat-agent" sql-name="agent"/>
        
    </concept>

    <concept name="salesman-workday">
        
        <select owner="dbo" sql-name="salesman_workday" type="procedure">
            <parameter name="cat-salesman" type="int" sql-name="@palm_salesman"/>
            <parameter name="date" type="date" sql-name="@ddate"/>
            <parameter name="id" type="int" sql-name="@saleperiod"/>
        </select>
        
        <save owner="dbo" sql-name="palm_saleperiod"/>
        
        <property name="id" type="int" key="true" sql-name="saleperiod_id"/>
        <property name="xid"/>
        
        <property name="date" type="date" label="Дата" sql-name="ddate"/>
        <property name="closed" type="boolean" label="Работа завершена" />
        <property name="processed" type="boolean" label="День обработан" />
        
        <role name="cat-salesman" actor="cat-salesman" sql-name="salesman_id"/>
        
    </concept>
    
    <concept name="cat-agent">
    
        <select owner="dbo" type="procedure" sql-name="agent">
            <parameter name="username" sql-name="@username" type="string"/>
        </select>
        
        <property name="id" type="int" key="true"/>
        <property name="name" type="string" label="Имя"/>
        <property name="username" type="string" label="Логин" />
        <property name="xid"/>
        
    </concept>


    <concept name="wan-stock">
        <select owner="dbo" type="procedure" sql-name="wan_stock">
            <parameter name="cat-salesman" type="int" sql-name="@salesman"/>
        </select>
        
        <property name="id" type="int"  key="true"/>
        
        <property name="remains" type="int" label="Остаток"/>
        
        <role name="article" actor="article" sql-name="goods"/>
        <role name="cat-salesman" actor="cat-salesman" sql-name="salesman"/>
        
    </concept>



    <concept name="wan-sale">
        <select owner="dbo" sql-name="wan_sale" type="procedure">
            <parameter name="state" type="string" sql-name="@state"/>
            <parameter name="cat-buyer" type="int" sql-name="@client"/>
            <parameter name="wan-pos" type="int" sql-name="@client"/>
            <parameter name="pricelist" type="int" sql-name="@pricelist"/>
            <parameter name="salesman-workday" type="int" sql-name="@saleperiod"/>
        </select>
        <save owner="dbo" sql-name="palm_sale"/>
        
        <property name="id" type="int" sql-name="sale_id" key="true"/>
        
        <property name="ndoc" type="string" label="№"/>
        <property name="date" type="date" label="Дата" sql-name="ddate"/>
        <property name="isCredit" type="boolean" sql-name="oncredit" label="Отсрочка оплаты"/>
        <property name="isWhite" type="boolean" sql-name="printdocset" label="Нужен счет-фактура"/>
        <property name="isCash" type="boolean" sql-name="iscash" label="Оплата наличными"/>
        <property name="isComplete" type="boolean" sql-name="iscomplete" />
        <property name="totalCost" type="decimal" sql-name="sumtotal" label="Стоимость"/>
        
        <role name="salesman-workday" actor="salesman-workday" sql-name="saleperiod_id"/>
        <role name="cat-buyer" actor="cat-buyer" sql-name="client_id"/>
        <role name="wan-pos" actor="wan-pos" sql-name="client_id"/>
        <role name="pricelist" actor="pricelist" sql-name="pricelist_id"/>
    </concept>

    <concept name="wan-saleitem">
        <select owner="dbo" sql-name="palm_saleitem"/>
        <save owner="dbo" sql-name="palm_saleitem"/>
        
        <property name="volume" type="int" label="Кол-во"/>
        <property name="price" type="decimal" label="Цена"/>
        <property name="cost" type="decimal" label="Стоимость"/>
        
        <role name="wan-sale" actor="wan-sale" sql-name="sale_id"/>
        <role name="article" actor="article" sql-name="goods_id"/>
    </concept>

    <concept name="wan-pos">
        <select owner="dbo" sql-name="wan_pos" type="procedure">
            <parameter name="cat-salesman" type="int" sql-name="@salesman"/>
            <parameter name="id" type="int" sql-name="@id"/>
        </select>
        <save owner="dbo" sql-name="wan_pos"/>
        
        <property name="id" type="int" key="true"/>
        
        <role name="cat-salesman" actor="cat-salesman" sql-name="salesman"/>
        <role name="cat-buyer" actor="cat-buyer" sql-name="client"/>
        <role name="pricelist" actor="pricelist" sql-name="pricelist"/>
        
    </concept>

    <concept name="wan-pricelist">
        <select owner="dbo" sql-name="wan_pricelist" type="procedure">
            <parameter name="cat-salesman" type="int" sql-name="@salesman"/>
        </select>
        
        <role name="cat-salesman" actor="cat-salesman" sql-name="salesman"/>
        <role name="pricelist" actor="pricelist" sql-name="pricelist"/>

    </concept>
    
</domain>
