<?xml version="1.0" ?>
<domain version="1.0"
    xmlns:xi="http://unact.net/xml/xi"
    xmlns="http://unact.net/xml/xi"
>
    <concept name="warehouse">
        <select owner="dbo" />
        <select owner="dbo" sql-name="warehouse" type="procedure">
            <parameter name="username" type="string" sql-name="@login" />
            <parameter name="sysuser" type="int" sql-name="@agent" />
        </select>
        <property name="id" key="true"/>
        <property name="name" type="string"/>
        <role name="sysuser" actor="sysuser" />
    </concept>

    <concept name="warehouse-goods">
        <select type="procedure" owner="dbo" sql-name="warehouse_goods">
            <parameter name="warehouse" type="int" sql-name="@wh"/>
            <parameter name="goods" type="int" sql-name="@goods"/>
        </select>
        <save type="procedure" owner="dbo" sql-name="warehouse_goods_set">
            <parameter name="warehouse" type="int" sql-name="@wh"/>
            <parameter name="goods" type="int" sql-name="@goods"/>
            <parameter name="address" type="string" sql-name="@address"/>
        </save>
        <property name="address" type="string" label="Адрес"/>
        <property name="remains" type="int" label="Остаток шт."/>
        <property name="supply" type="int" label="Поставка шт."/>
        <property name="mc-remains" type="decimal" label="Остаток кор." sql-compute="(select cast(remains/vrel as decimal(18,2)) from dbo.goods(@id=goods))"/>
        <role name="warehouse" actor="warehouse"/>
        <role name="goods" actor="goods"/>
    </concept>

    <!--concept name="sysuser-warehouse" type="association">
        <select owner="xmlgate" sql-name="agent_warehouse"/>
        <role name="sysuser" actor="sysuser" sql-name="agent" key="true"/>
        <role name="warehouse" actor="warehouse" key="true"/>
    </concept-->

    <concept name="goods">
        <select owner="wms"/>
        <select type="procedure" owner="wms">
            <parameter name="barcode" type="barcode" sql-name="@barcode"/>
            <parameter name="warehouse" type="int" sql-name="@warehouse"/>
            <parameter name="constrain" type="string" sql-name="@constrain"/>
        </select>
        <property name="id" key="true" type="int"/>
        <property name="name" type="string" label="Наименование"/>
        <property name="code" type="string" label="Артикул"/>
        <property name="prel" type="int" label="Коробов на палете"/>
        <property name="lastSeen" type="date" label="Прошлый приход" sql-name="lastSeen"/>
        <role name="warehouse" actor="warehouse"/>
    </concept>

    <concept name="picking-cell">
        <select type="procedure" owner="dbo" sql-name="picking_cell">
            <parameter name="searcher" type="string" sql-name="@searcher"/>
        </select>
        <save- owner="dbo" sql-name="wms_cell"/>
        <property name="id" key="true" type="int"/>
        <property name="name" type="string" label="Адрес" sql-name="address"/>
        <role name="goods" actor="goods" />
        <role name="warehouse" actor="warehouse"/>
    </concept>

    <concept name="wms-place-type">
        <select owner="wms" sql-name="place_type"/>

        <property name="id" key="true" type="string"/>
        <property name="name" type="string" label="Адрес" />
    </concept>

    <concept name="wms-place">
        <select owner="wms" sql-name="place"/>
        <save- owner="wms" sql-name="place"/>

        <property name="id" key="true" type="int"/>
        <property name="name" type="string" label="Адрес" />
        <property name="rowname" type="string" label="Ряд" />
        <property name="colname" type="string" label="Вертикаль" />
        <property name="level" type="string" label="Этаж" />
        <property name="ord" type="string" label="Порядок обхода" />

        <property name="ts" type="datetime" label="Обновлено" />
        <role name="warehouse" actor="warehouse" />
        <property name="wms-place-type" type="string" sql-name="outer_db"/>

    </concept>

    <concept name="wms-place-goods">
        <select owner="wms" sql-name="place_goods"/>
        <save   owner="wms" sql-name="place_goods"/>

        <property name="id" key="true" type="int"/>
        <property name="name" type="string" label="Адрес" />
        <property name="mc-volume" type="int" label="Кол-во коробов" sql-name="mcvol" />
        <property name="bl-volume" type="int" label="Кол-во коробов" sql-name="blvol" />
        <property name="pk-volume" type="int" label="Кол-во коробов" sql-name="pkvol" />
        <property name="mdate" type="date" label="Дата производства" sql-name="mdate" />

        <property name="ts" type="datetime" label="Обновлено" />
        
        <role name="goods" actor="goods" />
        <role name="wms-place" actor="wms-place" sql-name="place" />

    </concept>

    <concept name="wms-cell-cat">
        <select type="procedure" owner="dbo" sql-name="wms_cell">
            <parameter name="searcher" type="string" sql-name="@searcher"/>
            <parameter name="wms-place" type="string" sql-name="@wms_place"/>
            <parameter name="goods" type="int" sql-name="@goods"/>
        </select>
        <save type="procedure" owner="dbo" sql-name="cell_set">
            <parameter name="id" type="int" sql-name="@cell"/>
            <parameter name="remains" type="int" sql-name="@remains"/>
        </save>
        <property name="id" key="true" type="int"/>
        <property name="name" type="string" label="Адрес" sql-name="address"/>
        <property name="remains" type="int" label="Остаток" sql-name="comment"/>
        <property name="ts" type="datetime" label="Обновлено" />
        <property name="pdate" type="date" label="Дата производства" sql-name="productionDate"/>

        <role name="goods" actor="goods" />
        <role name="wms-place" actor="wms-place" />
    </concept>


    <concept name="wms-log">
        <select type="procedure" owner="wms" sql-name="log">
            <parameter name="wms-cell-cat" type="int" sql-name="@cell"/>
        </select>
        <property name="ts" type="datetime" label="Дата" />
        <role name="sysuser" sql-name="agent" actor="sysuser"/>
        <role name="wms-cell-cat" actor="wms-cell-cat"/>
    </concept>

    <concept name="wms-cell" storage="mssql" db="southwms" server="hqvsrv41">
        <select type="procedure" owner="dbo" sql-name="cell_fn">
            <parameter name="searcher" type="string" sql-name="@searcher"/>
        </select>
        <save owner="dbo" sql-name="cells"/>
        <property name="id" key="true" type="int"/>
        <property name="name" type="string" label="Адрес" sql-name="address"/>
        <property name="remains" type="string" label="Остаток" sql-name="comment"/>
        <property name="ts" type="datetime" label="Обновлено" />
        <role name="goods" actor="goods" />
    </concept>

    <concept name="wms-cell-inv" storage="mssql" db="southwms" server="hqvsrv41">
        <save owner="dbo" type="procedure" sql-name="cellinv">
            <parameter name="wms-cell" type="int" sql-name="@cell"/>
            <parameter name="goods" type="int" sql-name="@goods"/>
            <parameter name="remains" type="int" sql-name="@volume"/>
            <parameter name="sysuser" type="int" sql-name="@agent"/>
        </save>
        <property name="remains" type="int" label="Остаток" sql-name="comment"/>
        <role name="goods" actor="goods" />
        <role name="wms-cell" actor="wms-cell" sql-name="cell"/>
        <role name="sysuser" actor="sysuser" sql-name="agent"/>
    </concept>

    <concept name="wms-cell-get">
        <select owner="dbo" type="procedure" sql-name="cell_get">
            <parameter name="wms-cell-cat" type="int" sql-name="@cell"/>
            <parameter name="goods" type="int" sql-name="@goods"/>
            <parameter name="sysuser" type="int" sql-name="@agent"/>
        </select>
        <save owner="dbo" type="procedure" sql-name="cell_set">
            <parameter name="xid" type="string" sql-name="@xid"/>
            <parameter name="wms-cell-cat" type="int" sql-name="@cell"/>
            <parameter name="taken" type="int" sql-name="@taken"/>
            <parameter name="goods" type="int" sql-name="@goods"/>
            <parameter name="sysuser" type="int" sql-name="@agent"/>
        </save>
        <property name="xid"  key="true"/>
        <property name="taken" type="int" label="Сколько взяли"/>
        <role name="wms-cell-cat" actor="wms-cell-cat" sql-name="cell"/>
        <role name="goods" actor="goods"/>
        <role name="sysuser" actor="sysuser" sql-name="agent"/>
    </concept>

    <concept name="wms-cell-placement">
        <select owner="dbo" type="procedure" sql-name="cell_placement">
            <parameter name="sysuser" type="int" sql-name="@agent"/>
            <parameter name="goods" type="int" sql-name="@goods"/>
            <parameter name="volume" type="int" sql-name="@volume"/>
            <parameter name="wms-cell" type="int" sql-name="@cell"/>
        </select>
        <save owner="dbo" type="procedure" sql-name="cell_placement">
            <!--parameter name="xid" type="string" sql-name="@xid"/-->
            <parameter name="sysuser" type="int" sql-name="@agent"/>
            <parameter name="goods" type="int" sql-name="@goods"/>
            <parameter name="volume" type="int" sql-name="@volume"/>
            <parameter name="pdate" type="date" sql-name="@pdate"/>
            <parameter name="wms-cell" type="int" sql-name="@cell"/>
        </save>
        <property name="xid"  key="true"/>
        <property name="volume" type="int" label="Кол-во коробов"/>
        <property name="pdate" type="date" label="Дата производства"/>
        <role name="wms-cell" actor="wms-cell" sql-name="cell"/>
        <role name="sysuser" actor="sysuser" sql-name="agent"/>
        <role name="goods" actor="goods" />
    </concept>
    
    <concept name="wms-goods-recent-date">
        <select owner="wms" type="procedure" sql-name="goods_recent_date">
            <!--parameter name="warehouse" type="int" sql-name="@wh"/-->
            <parameter name="goods" type="int" sql-name="@goods"/>
        </select>
        <property name="pdate" type="date" label="Дата изготовления" />
        <!--role name="warehouse" actor="warehouse" sql-name="wh"/-->
        <role name="goods" actor="goods" />
    </concept>

    <concept name="wms-inv">
        <select owner="wms" type="procedure" sql-name="inv">
            <parameter name="warehouse" type="int" sql-name="@wh"/>
        </select>
        <property name="name" type="string" label="Дата" sql-name="ddate"/>
        <property name="id" type="int" />
        <role name="warehouse" actor="warehouse" sql-name="wh"/>
    </concept>

    <concept name="wms-progress">
        <select owner="wms" type="procedure" sql-name="progress"/>
        
        <property name="rowname" type="string" label="Ряд" />
        <property name="pick" type="string" label="Пикинг" />
        <property name="stock2" type="string" label="Сток 2" />
        <property name="stock3" type="string" label="Сток 3" />
        <property name="stock4" type="string" label="Сток 4" />
        <property name="stock5" type="string" label="Сток 5" />
        <property name="stock6" type="string" label="Сток 6" />
    </concept>

    <concept name="wms-operation">
        <select owner="wms" sql-name="operation"/>
        
        <property name="id" type="string" key="true"/>
        <property name="name" type="string" label="Наименование"/>
    </concept>

    <concept name="wms-operation-request">
        <select owner="wms" sql-name="operation_request"/>
        <save owner="wms" sql-name="operation_request"/>
        
        <property name="id" type="int" key="true"/>

        <property name="is-done" type="boolean" sql-name="is_done"/>
        
        <role name="wms-operation" actor="wms-operation" sql-name="operation"/>
        <role name="wms-place" actor="wms-place" sql-name="place" />

    </concept>

    <concept name="wms-operation-commit">
        <select owner="wms" sql-name="operation_commit"/>
        <save owner="wms" sql-name="operation_request"/>
        
        <property name="id" type="int" />

        <property name="is-done" type="boolean" sql-name="is_done"/>
        
        <role name="wms-operation" actor="wms-operation" sql-name="operation"/>
        <role name="wms-place" actor="wms-place" sql-name="place" />

    </concept>

    <concept name="goods-barcode">
        <select owner="dbo" sql-name="goods_barcode"/>
        <save owner="dbo" sql-name="goods_barcode"/>
        
        <property name="xid"/>
        <property name="id" key="true" type="int"/>

        <property name="barcode" type="string"/>
        
        <role name="goods" actor="goods" />
        <role name="package" actor="package" sql-name="measure" />
    </concept>
    
    <concept name="package">
        <select owner="dbo" sql-name="measures"/>
        <select type="procedure" owner="dbo">
            <parameter name="goods" type="int" sql-name="@goods"/>
        </select>
        
        <property name="id" key="true" type="int"/>
        <property name="name" type="string"/>
        <role name="goods" actor="goods" />
        
    </concept>

    <concept name="goods-condition">
        <select owner="wms" sql-name="goods_condition"/>
        
        <property name="id" type="string" key="true"/>
        <property name="name" type="string" label="Качество товара"/>
        
    </concept>

    <concept name="defect-cause">
        <select owner="wms" sql-name="defect_cause"/>
        
        <property name="id" type="string" key="true"/>
        <property name="name" type="string" label="Причина брака"/>
        
    </concept>
    
    <concept name="wms-defect-sorted">
        <select owner="wms" sql-name="defect_sorted"/>
        <save owner="wms" sql-name="defect_sorted"/>
        
        <property name="id" type="string" key="true"/>
        <property name="xid"/>
        
        <property name="volume" type="int" label="Кол-во"/>
        
        <role name="goods" actor="goods"/>
        <role name="wms-picking-box" actor="wms-picking-box" sql-name="picking_box"/>
        
    </concept>
    
    <concept name="wms-picking-box">
        <select owner="wms" sql-name="picking_box"/>
        <select owner="wms" type="procedure" sql-name="picking_box">
            <parameter name="barcode" type="string" sql-name="@barcode" required="true"/>
            <parameter name="sysuser" type="int" sql-name="@agent"/>
            <parameter name="warehouse" type="int" sql-name="@warehouse"/>
        </select>
        <save owner="wms" sql-name="picking_box"/>
        
        <property name="id" type="int" key="true"/>
        <property name="xid"/>
        <property name="ts" type="datetime" label="Когда обновлено"/>
        <property name="isWritten-off" type="boolean" sql-name="written_off" label="Резерв"/>
        
        <property name="barcode" type="string" label="Штрих-код"/>
        
        <role name="defect-cause" actor="defect-cause" sql-name="defect_cause"/>
        <role name="goods-condition" actor="goods-condition" sql-name="goods_condition"/>
        <role name="sysuser" actor="sysuser" sql-name="agent"/>
        <role name="warehouse" actor="warehouse"/>
        
    </concept>
    
    <concept name="wms-consignment-accept">
        <select owner="wms" sql-name="consignment_accepted"/>
        <select owner="wms" type="procedure" sql-name="consignment_accept">
            <parameter name="wms-picking-box" type="int" sql-name="@picking_box"/>
            <parameter name="sysuser" type="int" sql-name="@agent"/>
            <parameter name="warehouse" type="int" sql-name="@warehouse" required="true"/>
        </select>
        <save owner="wms" sql-name="consignment_accepted"/>
        
        <property name="id" type="string" key="true"/>
        <property name="xid"/>
        <property name="ts" type="datetime" label="Когда обновлено"/>
        <property name="isFinished" type="boolean" label="Приемка завершена"/>
        
        <role name="wms-picking-box" actor="wms-picking-box" sql-name="picking_box"/>
        <role name="sysuser" actor="sysuser" sql-name="agent"/>
        <role name="warehouse" actor="warehouse"/>
        
    </concept>

    <concept name="wms-consignment-expected">
        <select owner="wms" type="procedure" sql-name="consignment_expected">
            <parameter name="wms-picking-box" type="int" sql-name="@picking_box"/>
        </select>
                    
        <property name="volume" type="int" label="Кол-во"/>
        <property name="ts" type="datetime" label="Обновлено"/>
        
        <role name="goods" actor="goods"/>
        <role name="wms-picking-box" actor="wms-picking-box" sql-name="picking_box"/>
        
    </concept>
   
    <concept name="wms-consignment-accept-goods">
        <select owner="wms" sql-name="consignment_accepted_goods"/>
        <save owner="wms" sql-name="consignment_accepted_goods"/>
        
        <property name="id" type="string" key="true"/>
        <property name="xid"/>
        
        <property name="volume" type="int" label="Кол-во"/>
        
        <role name="wms-consignment-accept" actor="wms-consignment-accept" sql-name="consignment_accepted"/>
        <role name="goods" actor="goods"/>
        
    </concept>
    
</domain>
