<?xml version="1.0"?>

<view-definition xmlns="http://unact.net/xml/xi" version="1.0" name="jbr-history" label="История джаббера">

    <access role="alpha"/>

    <view-schema><form name="jbr-user">
        
        <parameter name="name"> <init with="username"/> </parameter>
        <parameter name="device-name"> <init with="device-name"/> </parameter>
        <parameter name="date" type="date"> <init with="today"/> </parameter>
        
        <field name="id" />
        
        <form name="jbr-message" page-size="20" role="jbr-user-from" is-set="true">
            
            <field name="direction"/>
            <field name="msg" hidden="true"/>
            <add-labeled-fields/>
            
            <field name="from-msg" sql-compute="null" label="to">
                <xpath-compute>
                    parent::xi:data [xi:datum[@name='direction' and text()='to']]
                    /xi:datum [@name='msg']
                </xpath-compute>
            </field>
            
            <field name="from-msg" sql-compute="null" label="from">
                <xpath-compute>
                    parent::xi:data [xi:datum[@name='direction' and text()='from']]
                    /xi:datum [@name='msg']
                </xpath-compute>
            </field>
            
        </form>
        
    </form></view-schema>
    
    <workflow>
        
        <step>
            
            <display>
                <print field="name" form="jbr-user"/>
                <grid form="jbr-message">
                    <group>
                        <by form="jbr-message" field="to-user"/>
                    </group>
                </grid>
            </display>
            
        </step>
        
    </workflow>
    
</view-definition>