<?xml version="1.0"?>
<view-definition xmlns="http://unact.net/xml/xi" name="encashmenting-by-zones" label="Инкассация по маршрутам" pipeline="views">
    <view-schema>
        <form name="branch" label="Отделение" expect-choise="true">
            <parameter name="username" type="string" label="Логин оператора"/>
            <field name="name" />
            <field name="id" />
            <form name="branch-workday" label="Рабочий день отделения">
                <parameter name="date" type="date" editable="true" label="Рабочий день">
                    <init with="today"/>
                </parameter>
                <field name="date"/>
                <field name="id" />
                <form name="branch-route" label="Маршрут инкассации" expect-choise="true">
                    <join name="branch"/>
                    <field name="id" />
                    <field name="name" />
                    <form name="encashment" label="Произведенная инкассация" is-set="true">
                        <field name="xid" key="true"/>
                    	<field name="IncassID" key="true"/>
                    	<join name="branch-workday"/>
                    	<reduce form="catterminal" field="id"/>
                        <form name="catterminal" key="true">
                            <join name="branch-route"/>
                            <form name="processing" >
                                <field name="name" label="Процессинг"/>
                            </form>
                        	<field name="terminalid" />
                            <field name="id"/>
                        	<field name="name"/>
                        	<field name="address" />
                        </form>
                    	<field name="datetime" label="Время инкассации" />
                    	<field name="cashed-system" label="Сумма из терминала" totals="sum"/>
                    	<field name="cashed-fact" label="Сумма реальная" editable="true" autofill="cashed-system" totals="sum"/>
                    </form>
                </form>
            </form>
        </form>
    </view-schema>
    <workflow>
        <step label="Регистрация сумм реальных инкассаций">
            <display>
                <input form="branch" />
                <input form="branch-route"/>
                <input form="branch-workday" field="date"/>
                <grid form="encashment">
                    <group>
                        <by form="processing" field="name"/>
                    </group>
                </grid>
            </display>
        </step>
    </workflow>
</view-definition>