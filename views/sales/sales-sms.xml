<?xml version="1.0"?>
<view-definition xmlns="http://unact.net/xml/xi" name="sales-smsing" label="СМС-рассылка торговым">
    <view-schema>
        <form name="sysuser">
            <parameter name="name">
                <init with="username"/>
            </parameter>
            <parameter name="msg" type="text" editable="true" label="Текст сообщения"/>
            <parameter name="includeSupervisor" type="boolean" editable="true" label="Оповестить супервайзеров?"/>
            <form name="sales-territory" is-set="true" label="Территория" removable="true">
                <field name="id"/>
            	<field name="name" label="Территория" />
                <form name="salesman-group" is-set="true">
                    <field name="id" />
                    <field name="name" />
                    <form name="sales-sms" build-blank="true" deletable="true" new-only="true">
                        <field name="xid"/>
                        <join name="sysuser" field="msg"/>
                        <join name="sysuser" field="includeSupervisor"/>
                    </form>
                	<!--form name="salesman" is-set="true">
                        <field name="id" />
                        <field name="name" />
                        <field name="mobilenum" editable="true"/>
                    </form-->
                </form>
            </form>
        </form>
    </view-schema>
    <workflow>
        <step>
            <display>
                <input field="msg" />
                <input field="includeSupervisor" />
                <grid form="sales-sms">
                    <column form="salesman-group" field="name"/>
                    <group>
                        <by field="name" form="sales-territory"/>
                    </group>
                </grid>
            </display>
            <validate>
                <nonempty form="sales-territory"/>
            </validate>
        </step>
        <step>
            <display>
               <print field="msg" />
               <print field="includeSupervisor" />
               <grid form="sales-sms">
                    <column form="salesman-group" field="name"/>
                    <group>
                        <by field="name" form="sales-territory"/>
                    </group>
                </grid>
            </display>
            <choise>
                <option label="Отправить">
                    <command name="save"/>
                    <command name="close"/>
                </option>
            </choise>
        </step>
    </workflow>
</view-definition>