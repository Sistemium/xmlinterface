<?xml version="1.0"?>
<view-definition xmlns="http://unact.net/xml/xi" name="gup-reestr-export" label="Реестр ГУП">
    <view-schema>
        <form name="op">
            <parameter name="date" editable="true" label="Дата" type="date">
				<init with="today"/>
			</parameter>
			<field name="dummy_col"/>
            <form name="gup-reestr" is-set="true" pipeline="csv1251">
				<join name="op" field="date"/>
            	<field name="receiptNumber" />
            	<field name="receiptDate"/>
            	<field name="summ" />
            	<field name="account" sql-compute="null" />
                <field name="Fio" />
                <field name="address" />
                <field name="ufkAccount" />
                <field name="ufkINN" />
                <field name="ufkName" />
                <field name="ufkBIK" />
                <field name="paymentType" />
                <field name="ufkKPP" />
                <field name="ufkKBK" />
                <field name="ufkOKATO" />
                <field name="field106" />
                <field name="field107" />
                <field name="field108" />
                <field name="field109" />
                <field name="field110" />
                <field name="field111" type="decimal" sql-compute="0.00"/>
            </form>
        </form>
    </view-schema>
    <workflow>
        <step label="Экспорт данных">
            <display>
				<input field="date" form="op"/>
                <export form="gup-reestr" type="csv1251" synthesize-attributes="true">
					<synthesize attribute="file-name"
						 xpath-precompute="ancestor::xi:view/xi:view-data/xi:data[@name='op']/xi:datum[@name='date']"
						    xpath-compute="concat('GUP_',substring($precompute,7,4),substring($precompute,4,2),substring($precompute,1,2),'.csv')"
					/>
				</export>
            </display>
        </step>
    </workflow>
</view-definition>