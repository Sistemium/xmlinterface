<?xml version="1.0"?>
<view-definition xmlns="http://unact.net/xml/xi" name="ua-roles" label="Роли UA">
    
    <view-schema><form name="UA">
        
        <parameter name="date" type="date"> <init with="today"/> </parameter>
        
        <form name="ua-role-detailed" concept="ua-role" deletable="true">
            
            <parameter name="detailed-role-xid" property="xid" modifiable="true"/>
            <field name="id"/>
            <add-labeled-fields/>
            
            <form name="ua-role-accounts" concept="ua-account-role" is-set="true" extendable-="true" deletable="true">
                
                <field name="xid"/>
                <form name="ua-role-account" concept="ua-account" role="ua-account" choise-="ua-account-cache" label="Обладатель">
                    <field name="id"/>
                    <field name="name"/>
                    <field name="code"/>
                </form>
                <field name="data" editable="true"/>
                
                <sort form="ua-role-account" field="name"/>
                
            </form>
            
        </form>
        
        <form name="ua-role" is-set="true" page-size="10"
            deletable="true" extendable="true" toggle-edit-off="true"
        >
            <field name="xid"/>
            
            <field name="name" editable="true"/>
            <field name="code" editable="true"/>
            
            <add-labeled-fields/>
            
        </form>
        
    </form></view-schema>
    
    <workflow>
        
        <step name="index">
            
            <display>
                <grid form="ua-role" label="Роли">
                    <option reuse="detail-role"/>
                </grid>
            </display>
            
        </step>
        
        <step name="detailed-role" hidden="true">
            
            <display>
                <region class="hbox">
                    <region class="sidebar">
                        <grid form="ua-role">
                            <option reuse="detail-role"/>
                            <columns>
                                <column field="name" label="Выберите роль"/>
                            </columns>
                        </grid>
                    </region>
                    <region class="flex">
                        <print form="ua-role-detailed" field="name" class="label" label="Роль"/>
                        <print form="ua-role-detailed" field="code"/>
                        <print form="ua-role-detailed" field="ts"/>
                        <grid form="ua-role-accounts" label="Обладатели"/>
                    </region>
                </region>
            </display>
            
        </step>
        
        <reusables>
            <option label="..." name="detail-role">
                <command name="ua-roles">detailed-role</command>
                <command name="detailed-role-xid" xpath-compute="xi:datum[@name='xid']" />
            </option>
        </reusables>
        
    </workflow>
    
</view-definition>
