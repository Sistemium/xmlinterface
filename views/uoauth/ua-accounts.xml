<?xml version="1.0"?>
<view-definition version="1.0" xmlns="http://unact.net/xml/xi" name="ua-accounts" label="Аккаунты UA">
    
    <view-schema><form name="UA">
        
        <parameter name="date" type="date"> <init with="today"/> </parameter>
        
        <form name="ua-account" is-set="true" page-size="20" deletable="true" toggle-edit-off="true">
            
            <add-labeled-fields/>
            
            <field name="code" editable="true"/>
            
            <order-by name="ts" dir="desc"/>
            
            <form name="ua-account-provider-agg" concept="ua-account-provider">
                <field name="id" aggregate="count" label="Связано аккаунтов"/>
            </form>
            
            <form name="ua-account-role" is-set="true" extendable="true">
                <form name="ua-account-role-name" concept="ua-role">
                     <field name="id"/>
                    <field name="name" label="Провайдер"/>
                </form>
                <field name="data" editable="true"/>
            </form>
            
            <form name="ua-account-provider" is-set="true" preload="true">
                <form name="ua-account-provider-name" concept="ua-provider">
                    <field name="name" label="Провайдер"/>
                </form>
                <field name="data"/>
            </form>
            
        </form>
        
        <form name="ua-provider" is-set="true" page-size="20">
            
            <add-labeled-fields/>
            <order-by name="ts" dir="desc"/>
            
        </form>
        
        <form name="ua-client" is-set="true" page-size="20" extendable="true" toggle-edit-off="true">
            
            <field name="xid"/>
            <add-labeled-fields/>
            <field name="code" editable="true"/>
            <field name="name" editable="true"/>
            <field name="secret" editable="password"/>
            <field name="redirectUrl" editable="true"/>
            <order-by name="ts" dir="desc"/>
            
        </form>
        
        <form name="ua-role" is-set="true" page-size="20">
            
            <add-labeled-fields/>
            <order-by name="ts" dir="desc"/>
            
        </form>
        
    </form></view-schema>
    
    <workflow name="ua-accounting">
        
        <step name="index">
            
            <display>
                <region class="tabs">
                    <grid form="ua-client" label="Клиенты"/>
                    <grid form="ua-role" label="Роли"/>
                </region>
            </display>
            
            <!--workflow name="manage">
                <step name="acccounts" -->
                    <display>
                        <grid form="ua-account" label="Аккаунты">
                            <option name="show-account-provider-data" label="...">
                                <command xpath-compute="
                                    xi:preload[@name='set-of-ua-account-provider']/@id
                                ">refresh</command>
                            </option>
                            <columns>
                                <column field="id"/>
                                <column field="name"/>
                                <column field="code"/>
                                <column field="email"/>
                                <column form="ua-account-provider-agg" field="id"/>
                                <column label="Данные провайдеров">
                                    <grid form="ua-account-provider"/>
                                </column>
                                <column label="Назначенные роли">
                                    <grid form="ua-account-role"/>
                                </column>
                            </columns>
                        </grid>
                    </display>
                <!--/step>
                
                <step name="providers" -->
                    <display>
                        <grid form="ua-provider" label="Провайдеры"/>
                    </display>
                <!--/step>
            </workflow-->
            
        </step>
        
    </workflow>
    
</view-definition>