<?xml version="1.0"?>
<view-definition xmlns="http://unact.net/xml/xi" name="iexp" >
    
    <access role="expeditor"/>
    
    <view-schema version="1.0" >
        <form name="sysuser">
            
            <parameter name="name"> <init with="username"/> </parameter>
            <parameter name="device-name"> <init with="device-name"/> </parameter>
            <parameter name="username"> <init with="username"/> </parameter>
            <parameter name="date" type="date"> <init with="today"/> </parameter>
            
            <form name="Person" concept="cat-agent">
                <field name="id" />
                <field name="name"/>
                
                <join name="sysuser" field="username"/>
                
                <form name="Warehouse" concept="sales-warehouse" is-set="true">
                    <field name="id" />
                    <field name="name" />
                </form>
                
                <form name="cat-salesman">
                    <field name="id" />
                    <field name="name" />
                    
                    <form name="salesman-workday">
                        <field name="id" />
                        <join name="sysuser" field="date"/>
                        
                        <form name="Route" concept="expedition" pipeline="download">
                            <join name="Person"/>
                            <join name="sysuser" field="date"/>
                            <field name="id" />
                            <field name="name" />
                            
                            <form name="RoutePoint" concept="expedition-destination" is-set="true">
                                <field name="xid" />
                                <field name="isComplete" format="true-only" label="Г" modifiable="true"/>
                                <field name="name" label="Адрес"/>
                                
                                <order-by name="ord" dir="desc"/>
                                <order-by name="address" dir="asc"/>
                                
                                <form name="Customer" concept="cat-buyer">
                                    <field name="id"/>
                                    <field name="name"/>
                                    <field name="address"/>
                                    <field name="sales-warehouse" alias="warehouse"/>
                                    <field name="cat-partner" alias="partner"/>
                                    
                                    <secure not-role="torgpred">
                                        <join name="salesman-workday"/>
                                    </secure>
                                    
                                    <secure role="torgpred">
                                        <join name="cat-salesman"/>
                                    </secure>
                                        
                                    <!--form name="Point" concept="geo-point" pipeline="download">
                                        <field name="id"/>
                                        <field name="name"/>
                                        <field name="lat"/>
                                        <field name="lng"/>
                                    </form-->
                                    
                                </form>
                            </form>
                        </form>
                        
                    </form>
                    
                </form>
                
                <form name="Category" concept="category" is-set="true" pipeline="download">
                    <field name="id"/>
                    <field name="name"/>
                    <field name="ord"/>
                    
                    <order-by name="ord" dir="asc"/>
                    
                    <where name="volOrder">
                        <more-than>0</more-than>
                    </where>
                    
                    <form name="Product" concept="article" is-set="true" pipeline="download">
                        <field name="id"/>
                        <field name="name"/>
                        <field name="first-name" alias="firstName"/>
                        <field name="factor" />
                        <field name="rel" />
                        <where name="isRemoved">0</where>
                    </form>
                </form>
                
            </form>
            
        </form>
    </view-schema>
    <workflow>
    </workflow>
</view-definition>