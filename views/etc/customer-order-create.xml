<?xml version="1.0"?>
<view-definition xmlns="http://unact.net/xml/xi" name="customer-order-create" label="Создание заказа">
    <view-schema>
        <form name="sysuser">
            <parameter name="name">
                <init with="username"/>
            </parameter>
            <field name="id"/>
            <form name="customer-sysuser" is-set="true">
                <form name="customer">
                    <field name="id"/>
                    <field name="name" label="Покупатель"/>
                    <form name="customer-order">
                        <field name="id"/>
                        <!--form name="category-cache" concept="category" is-set="true">
                            <field name="id"/>
                            <field name="name" label="Категория"/>
                        </form-->
                        <form name="category" label="Категория" is-set-="true" expect-choise="true">
                            <field name="id"/>
                            <field name="name" label="Категория"/>
                            <order-by name="ord" dir="asc"/>
                            <form name="article" is-set="true" label="Ассортимент">
                                <field name="id"/>
                                <field name="name"/>
                                <order-by name="name" dir="asc"/>
                                <!--form name="package-cache" concept="package" role="category-package">
                                    <field name="id"/>
                                    <field name="name"/>
                                </form-->
                                <form name="order-position-available" constrain-parent="true">
                                    <field name="rel" label="Кр."/>
                                    <field name="price" label="Цена"/>
                                    <form name="customer-order-position" build-blank="true">
                                        <field name="xid" />
                                        <field name="volume" label="Кол-во" autosave="true" editable="true" when-null-then-delete="true">
                                            <spin form="order-position-available" field="rel"/>
                                        </field>
                                        <join name="customer-order"/>
                                        <join name="article"/>
                                        <field name="vol">
                                            <compute field="rel" form="order-position-available" with="*">
                                                <field name="volume" form="customer-order-position"/>
                                            </compute>
                                        </field>
                                    </form>
                                        
                                        <!-- 
                                            select, blank, recursive transform, flat (not-set) @ref:@form@field
                                            autosave(category-choise sumbit)
                                            natural key
                                            xsl-apply post
                                            xml post
                                            data calendar-view
                                        -->
                                </form>
                            </form>
                        </form>
                    </form>
                </form>
            </form>
        </form>
    </view-schema>
    <workflow>
        <step label-="Выбор покупателя">
            <display>
                <print form="customer" field="name"/>
                <input form="category"/>
                <grid form="article"/>
            </display>
        </step>
        <!--step label="Выбор товаров">
            <display>
            </display>
        </step-->
    </workflow>
</view-definition>