<?xml version="1.0"?>
<view-definition xmlns="http://unact.net/xml/xi" name="goods" label="Товары">
    
    <access role="disabled"/>

    <view-schema>
        <form name="warehouse">
            <parameter name="username">
                <init with="username"/>
            </parameter>
            <parameter name="barcode" type="string" label="Штрих-код" editable="true" optional="true"/>

            <field name="id" />
            <field name="name" label="Склад"/>

            <form name="goodspackage" label="Товар в упаковке" is-set="true">
                <form name="goods-display" concept="goods" role="goods">
                    <field name="id" />
                    <field name="name" label="Товар"/>
                    <form name="warehouse-goods">
                        <field name="address"/>
                        <join name="warehouse" />
                        <join name="goods-display" />
                    </form>
                </form>
                <form name="package-display" concept="package" role="package">
                    <field name="id" />
                    <field name="name" label="Упаковка"/>
                </form>
                <join name="warehouse" field="barcode"/>
            </form>

            <form name="goods" label="Товар">
                <parameter name="code" editable="true" label="Артикул" type="string"/>
                <field name="id" key="true"/>
                <field name="name"/>
                <form name="package" label="Упаковка">
                    <field name="id" key="true"/>
                    <field name="name" />
                    <form name="goods-barcode" label="Товар в упаковке" new-only="true">
                        <field name="xid" key="true"/>
                        <join name="warehouse" field="barcode"/>
                        <join name="goods" />
                    </form>
                </form>
            </form>
            
        </form>
    </view-schema>
    <workflow>
        <step label="Поиск товара">
            <display>
                <input form="warehouse" field="barcode"/>
                <grid form="goodspackage"/>
            </display>
            <!--validate>
                <nonempty field="barcode"/>
            </validate-->
        </step>
        <step label="Добавление штрих-кода">
            <display>
                <print form="warehouse" field="barcode"/>
                <input form="goods" field="code"/>
                <print form="goods" field="name"/>
                <print form="package" field="name"/>
                <!--print form="package-choise" field="name"/-->
            </display>
        </step>
    </workflow>
</view-definition>