<?xml version="1.0"?>
<view-definition xmlns="http://unact.net/xml/xi" name="pc-queueinfos" label="Состояние пост-процессинга">
    <view-schema>
        <form name="op">
            <parameter name="name">
                <init with="username"/>
            </parameter>
            <form name="pc-queue-error" is-set="true" >
                <all-labeled-fields/>
            </form>
            <form name="pc-queueinfo" label="Очередь ОП" is-set="true" >
                <all-labeled-fields/>
                <field name="nonFinalCount" totals="sum"/>
                <field name="ppin" totals="sum"/>
                <field name="ppout" totals="sum"/>
                <order-by name="name" dir="asc"/>
            </form>
            <secure role="finances">
                <form name="op-legalentity" label="Распределение" is-set="true">
                    <secure role="master" toggle-edit-off="true"/>
                    <field name="xid"/>
                    <field name="name"/>
                    <field name="ratio"><secure role="master" editable="true"/></field>
                    <field name="todayPercent"/>
                    <field name="todayPaymentsSum" totals="sum"/>
                </form>
                <form name="legalentity-pc" label="Счета в ПЦ" is-set="true">
                    <secure role="master" toggle-edit-off="true"/>
                    <field name="xid"/>
                    <field name="name"/>
                    <field name="minFunds"><secure role="master" editable="true"/></field>
                    <field name="funds"/>
                    <field name="processedToday" totals="sum"/>
                    <where name="active">1</where>
                </form>
            </secure>
        </form>
    </view-schema>
    <workflow>
        <step label="Платежи">
            <display>
                <grid form="pc-queueinfo" label="Незавершенные транзакции"/>
                <grid form="pc-queue-error" label="Детализация очереди"/>
            </display>
        </step>
        <secure role="finances">
            <step label="Финансы">
                <display>
                    <grid form="legalentity-pc" label="Счета в плат. системах"/>
                    <grid form="op-legalentity" label="Распределение по юрлицам"/>
                </display>
            </step>
        </secure>
    </workflow>
</view-definition>