<?xml version="1.0"?>
<view-definition xmlns="http://unact.net/xml/xi" name="wms-placement" label="Пополнение стока">
    <view-schema>
        <form name="sysuser">
            <parameter name="name">
                <init with="username"/>
            </parameter>
            <field name="id"/>
            <form name="warehouse" label="Склад">
                <field name="id" />
                <field name="name" label="Склад"/>
                <form name="goods" label="Товар" read-only="true">
                    <parameter name="barcode" type="string" label="Штрих-код" editable="true"/>
                    <natural-order/>
                    <field name="id" />
                    <field name="code" />
                    <field name="prel" />
                    <field name="name" label="Товар"/>
                    
                    <secure not-role="fotonova">
                        <form name="wms-goods-recent-date" is-set="true">
                            <field name="pdate" focusable="true" label="Недавние даты производства"/>
                        </form>
                    </secure>
                    
                    <form name="wms-cell-placement" new-only="true" build-blank="true">
                        <field name="volume" editable="true" label="Кол-во коробов"/>
                        <field name="pdate" editable="true" label="Дата производства" autofill="pdate" autofill-form="wms-goods-recent-date"/>
                        
                        <join name="sysuser"/>
                        <form name="wms-cell" concept="wms-cell-cat"  label="Место хранения" >
                            <parameter name="searcher" editable="true" label="Поиск ячейки"/>   
                            <field name="id"/>
                            <field name="name"/>
                        </form>
                    </form>
                    
                </form>
            </form>
        </form>
    </view-schema>
    <workflow>
        <step label="Поиск товара">
            <display>
                <input form="goods" field="barcode"/>
                <print form="goods" field="name"/>
            </display>
            <validate>
                <nonempty form="goods"/>
            </validate>
        </step>
        <step label="Ввод количества">
            <display>
                <print form="wms-cell" field="name"/>
                <print form="goods" field="name"/>
                <print form="goods" field="code"/>
                <print form="goods" field="prel"/>
                <input form="wms-cell-placement" field="volume"/>
                <secure not-role="fotonova">
                    <grid form="wms-goods-recent-date"/>
                    <input form="wms-cell-placement" field="pdate"/>
                </secure>
            </display>
            <validate>
                <nonempty form="wms-cell-placement" field="volume"/>
                <secure not-role="fotonova">
                    <nonempty form="wms-cell-placement" field="pdate"/>
                </secure>
            </validate>
        </step>
        <step label="Поиск ячейки">
            <display>
                <print form="goods" field="name"/>
                <print form="goods" field="code"/>
                <input form="wms-cell" field="searcher" />
                <print form="wms-cell" field="name"/>
            </display>
            <validate>
                <nonempty form="wms-cell"/>
            </validate>
        </step>
        <step label="Проверьте данные">
            <display>
                <print form="wms-cell" field="name"/>
                <print form="goods" field="name"/>
                <print form="wms-cell-placement" field="volume"/>
                <print form="wms-cell-placement" field="pdate"/>
            </display>
            <choise>
                <option label="Подтвердить">
                    <command name="save"/>
                    <command name="refresh"/>
                </option>
            </choise>
        </step>
    </workflow>
</view-definition>